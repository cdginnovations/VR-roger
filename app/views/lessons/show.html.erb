
<div class="course_title">
  <%= @lesson.title %>
</div>
<br>





<%if current_user.role == @r[3] %>

    <h1>Traineee here</h1>

    <ziggeo
    ziggeo-width=450
    ziggeo-height=300>
    </ziggeo>



    <%= form_for [@lesson , @rehearsal],html: {id: "tokenForm"}, remote: true  do |f| %>
        <% if @rehearsal.errors.any? %>
            <div id="error_explanation">
              <h2><%= pluralize(@lesson.errors.count, "error") %> prohibited this rehearsal from being saved:</h2>

              <ul>
                <% @rehearsal.errors.full_messages.each do |message| %>
                    <li><%= message %></li>
                <% end %>
              </ul>
            </div>
        <% end %>

        <%= f.text_field :progress_id, type:"hidden" %>
        <%= f.text_field :course_id, type:"hidden"  %><br>
        <%= f.text_field :trainee_id, type:"hidden", value:current_user.id %><br>
        <%= f.text_field :lesson_id, type:"hidden", value:@lesson.id %><br>
        <%= f.text_field :video_token, type:"hidden" %>
        <%= f.text_field :token, type:"hidden" %>
    <% end %>

    <script >

      function postVideoToken(videoToken, streamToken){

        $form = $('#tokenForm');
        $ziggeotoken = $('#rehearsal_video_token');
        $webtoken = $('#rehearsal_token');

        $ziggeotoken.val(videoToken);
        $webtoken.val(streamToken)
        $form.submit();
      };
      // function postStreamToken(streamToken){
      //
      // };
      ZiggeoApi.Events.on("submitted", function (data) {

        // getting the string token and storing it in videoToken var to ship it to the outside world
        var streamToken = data.stream.token
        var videoToken = data.stream.video_token
        console.log(videoToken);
        console.log(streamToken);

        // here is where we grab the token to escort it outside of the ziggeo api on click event
        postVideoToken(videoToken, streamToken);


        // console.log(streamToken);

      });
    </script>












<% end %>













<%if current_user.level_2 %>


  <%@explanations.each do |explanation| %>
      <%= explanation.title %><br>
  <%end%>


  <!-- EXPLANATION -->
  <%= form_for [@lesson, @explanation]  do |f| %>
    <% if @explanation.errors.any? %>
      <div id="error_explanation">
        <h2><%= pluralize(@lesson.errors.count, "error") %> prohibited this lesson from being saved:</h2>
        <ul>
        <% @explanation.errors.full_messages.each do |message| %>
          <li><%= message %></li>
        <% end %>
        </ul>
      </div>
    <% end %>
    <div style="display: none;">
      <%= f.text_field :user_id, type:"hidden", value:current_user.id %><br>
      <%= f.text_field :lesson_id, type:"hidden", value:params[:id] %><br>
      <!-- <%= f.text_field :script, type:"hidden" %><br> -->
      <!-- <%= f.text_field :video_token, type:"hidden" %> -->
      <!-- <%= f.text_field :token, type:"hidden" %> -->
    </div>
    <%= f.submit 'Add Explanation' %>
  <% end %>



  <!-- PROMT -->
  <%= form_for [@lesson, @prompt]  do |f| %>
    <% if @prompt.errors.any? %>
      <div id="error_explanation">
        <h2><%= pluralize(@prompt.errors.count, "error") %> prohibited this lesson from being saved:</h2>

        <ul>
        <% @prompt.errors.full_messages.each do |message| %>
          <li><%= message %></li>
        <% end %>
        </ul>
      </div>
    <% end %>

    <%= f.text_field :user_id, type:"hidden", value:current_user.id %><br>
    <%= f.text_field :lesson_id, type:"hidden", value:params[:id] %><br>
    <!-- <%= f.text_field :script, type:"hidden" %><br> -->
    <!-- <%= f.text_field :video_token, type:"hidden" %> -->
    <!-- <%= f.text_field :token, type:"hidden" %> -->
    <%= f.submit 'Add Prompt' %>
  <% end %>




  <!-- MODEL -->
  <%= form_for [@lesson, @model]  do |f| %>
    <% if @model.errors.any? %>
      <div id="error_explanation">
        <h2><%= pluralize(@lesson.errors.count, "error") %> prohibited this lesson from being saved:</h2>

        <ul>
        <% @explanation.errors.full_messages.each do |message| %>
          <li><%= message %></li>
        <% end %>
        </ul>
      </div>
    <% end %>

    <%= f.text_field :user_id, type:"hidden", value:current_user.id %><br>
    <%= f.text_field :lesson_id, type:"hidden", value:params[:id] %><br>
    <!-- <%= f.text_field :script, type:"hidden" %><br> -->
    <!-- <%= f.text_field :video_token, type:"hidden" %> -->
    <!-- <%= f.text_field :token, type:"hidden" %> -->
    <%= f.submit 'Add Role Model' %>
  <% end %>




  <!-- CONCEPTS -->
  <%= form_for [@lesson, @concept]  do |f| %>
    <% if @concept.errors.any? %>
      <div id="error_explanation">
        <h2><%= pluralize(@concept.errors.count, "error") %> prohibited this lesson from being saved:</h2>

        <ul>
        <% @concept.errors.full_messages.each do |message| %>
          <li><%= message %></li>
        <% end %>
        </ul>
      </div>
    <% end %>

    <%= f.text_field :user_id, type:"hidden", value:current_user.id %><br>
    <%= f.text_field :lesson_id, type:"hidden", value:params[:id] %><br>
    <%= f.text_field :description, placeholder: 'Concepts' %><br>
    <%= f.submit 'Add Concepts to this lesson' %>
  <% end %>
<%end%>
